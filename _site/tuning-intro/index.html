<!DOCTYPE html>
<html>
  <head>
    <title>実装とともに学ぶハイパーパラメータチューニングのお話 – きままにNLP – A Technical Blog about NLP and ML</title>

        <meta charset="utf-8" />
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'>

    
    <meta name="description" content="はじめに
前回は交差検証について紹介をしました。今回は、ゼロからKerasシリーズの総まとめとして、ハイパーパラメータチューニングについて紹介します。実装例としては、Keras Tuner と呼ばれる、Keras用のハイパーパラメータ自動最適化ツールを活用した実装を紹介します。

" />
    <meta property="og:description" content="はじめに
前回は交差検証について紹介をしました。今回は、ゼロからKerasシリーズの総まとめとして、ハイパーパラメータチューニングについて紹介します。実装例としては、Keras Tuner と呼ばれる、Keras用のハイパーパラメータ自動最適化ツールを活用した実装を紹介します。

" />
    
    <meta name="author" content="きままにNLP" />

    
    <meta property="og:title" content="実装とともに学ぶハイパーパラメータチューニングのお話" />
    <meta property="twitter:title" content="実装とともに学ぶハイパーパラメータチューニングのお話" />
    

    <!--[if lt IE 9]>
      <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link rel="stylesheet" type="text/css" href="/style.css" />
    
      
        <link rel="stylesheet" type="text/css" href="/css/post.css">
      
    
    <link rel="alternate" type="application/rss+xml" title="きままにNLP - A Technical Blog about NLP and ML" href="/feed.xml" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
    
    <!-- Created with Jekyll Now - http://github.com/barryclark/jekyll-now -->

    <!-- Favicon head tag -->
    <link rel="icon" href="/resources/logo/kimamani_simple.png" type="image/x-icon">

    <!-- Begin Jekyll SEO tag v2.6.0 -->
<title>実装とともに学ぶハイパーパラメータチューニングのお話 | きままにNLP</title>
<meta name="generator" content="Jekyll v3.8.6" />
<meta property="og:title" content="実装とともに学ぶハイパーパラメータチューニングのお話" />
<meta property="og:locale" content="ja_JP" />
<meta name="description" content="ハイパーパラメータチューニングの基礎について、Keras Tunerを活用した実装例とともに学びます。" />
<meta property="og:description" content="ハイパーパラメータチューニングの基礎について、Keras Tunerを活用した実装例とともに学びます。" />
<link rel="canonical" href="http://localhost:4000/tuning-intro/" />
<meta property="og:url" content="http://localhost:4000/tuning-intro/" />
<meta property="og:site_name" content="きままにNLP" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-08-15T00:00:00+01:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="実装とともに学ぶハイパーパラメータチューニングのお話" />
<meta name="twitter:site" content="@_gucciiiii" />
<script type="application/ld+json">
{"description":"ハイパーパラメータチューニングの基礎について、Keras Tunerを活用した実装例とともに学びます。","@type":"BlogPosting","url":"http://localhost:4000/tuning-intro/","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/resources/logo/kimamani.png"}},"headline":"実装とともに学ぶハイパーパラメータチューニングのお話","dateModified":"2019-08-15T00:00:00+01:00","datePublished":"2019-08-15T00:00:00+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/tuning-intro/"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <!-- Google Adsense-->
    <!--
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-1838422896597988",
        enable_page_level_ads: true
      });
    </script>
    -->
  </head>

  <body>
    <div class="wrapper-masthead">
      <div class="head_container">
        <header class="masthead clearfix">
          <a href="/" class="site-avatar"><img src="/resources/logo/kimamani.png" /></a>

          <div class="site-info">
            <h1 class="site-name"><a href="/"><img src="/resources/logo/kimamani_moji.png" /></a></h1>
          </div>

          <nav>
            <a href="/">Blog</a>
            <a href="/about">About</a>
          </nav>
        </header>
      </div>
    </div>

    <div class="container">
      <main class="main_contents" role="main">
        <article class="post">
  <div class="date_front">
    <i class="far fa-calendar-alt" style="padding: 0 2px 0 0;"></i>
    2019-08-15

    

  </div>
  <h1>実装とともに学ぶハイパーパラメータチューニングのお話</h1>

  <div class="post-tag">
    




<ul>
  <i class="fas fa-tag" style="padding: 0 2px 0 0;"></i>
  
    <li>
      <a href="/sitemap#Tips">
        Tips
      </a>
    </li>
  
    <li>
      <a href="/sitemap#機械学習全般">
        機械学習全般
      </a>
    </li>
  
    <li>
      <a href="/sitemap#「ゼロからKeras」シリーズ">
        「ゼロからKeras」シリーズ
      </a>
    </li>
  
</ul>
  </div>

  <div class="toc">
    <input type="checkbox" id="toc_lb" class="on-off" />
    <label for="toc_lb">目次</label>
    <ul>
  <li><a href="#はじめに">はじめに</a></li>
  <li><a href="#1-ハイパーパラメータとは">1. ハイパーパラメータとは</a></li>
  <li><a href="#2-実装">2. 実装</a>
    <ul>
      <li><a href="#21-keras-tunerについて">2.1 Keras Tunerについて</a></li>
      <li><a href="#22-keras-tunerのインストール">2.2 Keras Tunerのインストール</a></li>
      <li><a href="#23-cnnモデルの実装">2.3 CNNモデルの実装</a>
        <ul>
          <li><a href="#231-ライブラリ読み出し">2.3.1 ライブラリ読み出し</a></li>
          <li><a href="#232-モデルの定義">2.3.2 モデルの定義</a></li>
          <li><a href="#233-データの読み込み">2.3.3 データの読み込み</a></li>
          <li><a href="#234-randomsearchクラスのインスタンス生成">2.3.4 RandomSearchクラスのインスタンス生成</a></li>
          <li><a href="#234-ランダムサーチの実行">2.3.4 ランダムサーチの実行</a></li>
          <li><a href="#235-チューニング結果の確認">2.3.5 チューニング結果の確認</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#まとめ">まとめ</a></li>
  <li><a href="#ソースコード">ソースコード</a></li>
</ul>
  </div>

  <div class="entry">
    <h2 id="はじめに">はじめに</h2>
<p><a href="https://gucci-j.github.io/cv-intro/">前回</a>は交差検証について紹介をしました。今回は、ゼロからKerasシリーズの総まとめとして、ハイパーパラメータチューニングについて紹介します。実装例としては、<a href="https://github.com/keras-team/keras-tuner">Keras Tuner</a> と呼ばれる、Keras用のハイパーパラメータ自動最適化ツールを活用した実装を紹介します。</p>

<div class="crowdfunding_ad">
    <div class="pc" style="text-align: center;">
        <a href="https://anchor.fm/melancholy">
            <img src="/resources/ads/mefm_banner_large.png" alt="めらんこりーFM!" />
        </a>
        <br />
    </div>
    <div class="sp" style="text-align: center;">
        <a href="https://anchor.fm/melancholy">
            <img src="/resources/ads/mefm_banner_small.png" alt="めらんこりーFM!" />
        </a>
        <br />
    </div>
</div>

<h2 id="1-ハイパーパラメータとは">1. ハイパーパラメータとは</h2>
<p>ハイパーパラメータとは、最適化アルゴリズムによって最適化できないパラメータのことを指します。例えば、学習エポック数やバッチサイズ・隠れ層の次元数、学習率などがあたります。</p>

<p>最適化アルゴリズムでは最適化できないハイパーパラメータを最適化するには、人手ではなく、専用のツールを使うのが便利です。専用のツールはたくさん種類があるので、フレームワーク等の状況に応じたものを取捨選択すると良いです。</p>

<h2 id="2-実装">2. 実装</h2>
<p>例によって、画像データセット: CIFAR10 の分類実験を題材にハイパーパラメータチューニングを実施してみます。基にするソースコードは前回の交差検証で用いた、<code class="highlighter-rouge">cnn.py</code> とします。冒頭で述べたように、Keras Tuner を活用して実装を行います。</p>

<blockquote>
  <p><i class="fas fa-link" style="padding: 0 2px 0 0;"></i>参照: <a href="https://github.com/gucci-j/intro-deep-learning-keras/tree/master/cross-validation/src">（GitHub: cnn.py）</a></p>
</blockquote>

<h3 id="21-keras-tunerについて">2.1 Keras Tunerについて</h3>
<p>Keras Tuner は、その名の通り Keras 用に開発中のハイパーパラメータ最適化ツールです。現時点で対応している最適化手法は、「ランダムサーチ」と <code class="highlighter-rouge">Hyperband</code> になります。今回はランダムサーチを適用してチューニングを行います。ランダムサーチは決められた範囲内からパラメータをランダムに選択し、試していく手法です。</p>

<p>なお、Keras Tuner は、TensorFlow 2.0 以降のTensorFlowに統合されたKeras (<code class="highlighter-rouge">tf.keras</code>) に対応していることが明記されているので、これまで本ブログで扱ってきたいわゆる無印Keras とは少し異なります。そのため、本記事では、無印Kerasユーザの方でも、<code class="highlighter-rouge">tf.keras</code> を使って最低限動かせるような構成にしてあります。</p>

<blockquote>
  <p><i class="fas fa-link" style="padding: 0 2px 0 0;"></i>参照: <a href="https://github.com/keras-team/keras-tuner">（GitHub: Keras Tuner）</a></p>
</blockquote>

<h3 id="22-keras-tunerのインストール">2.2 Keras Tunerのインストール</h3>
<p>まずは、Keras Tunerをインストールします。Python 3.6〜 と TensorFlow 2.0 が Requirementsとして指定されています。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/keras-team/keras-tuner.git
cd keras-tuner
pip install .
</code></pre></div></div>

<h3 id="23-cnnモデルの実装">2.3 CNNモデルの実装</h3>
<p>これまで活用してきた、<code class="highlighter-rouge">cnn.py</code> は <code class="highlighter-rouge">tf.keras</code> に互換性がないので、<code class="highlighter-rouge">tf.keras</code> 向けに書き換えます。</p>

<h4 id="231-ライブラリ読み出し">2.3.1 ライブラリ読み出し</h4>
<p>ライブラリ読み出し部分は至って簡単に移植できます。今までのソースコードに、<code class="highlighter-rouge">tensorflow.</code> を追加するだけです。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">tensorflow.keras</span> <span class="kn">import</span> <span class="n">Model</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">Input</span><span class="p">,</span> <span class="n">Dense</span><span class="p">,</span> <span class="n">Flatten</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">Conv2D</span><span class="p">,</span> <span class="n">MaxPooling2D</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.optimizers</span> <span class="kn">import</span> <span class="n">Adam</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.datasets</span> <span class="kn">import</span> <span class="n">cifar10</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.utils</span> <span class="kn">import</span> <span class="n">to_categorical</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
</code></pre></div></div>

<p>Keras Tuner のライブラリも読み込ませます。</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">kerastuner.tuners</span> <span class="kn">import</span> <span class="n">RandomSearch</span>
</code></pre></div></div>

<h4 id="232-モデルの定義">2.3.2 モデルの定義</h4>
<p>モデルの定義部分は、Keras Tuner 向けに書き換える必要が出てきます。具体的には、次の2点について改造を施します。</p>
<ul>
  <li>引数に <code class="highlighter-rouge">hp</code> : ハイパーパラメータ を取らせる</li>
  <li>チューニングしたいハイパーパラメータの部分を、<code class="highlighter-rouge">hp.Range</code> に置き換える。</li>
</ul>

<p><code class="highlighter-rouge">hp.Range</code> の使い方は次の表の通りです。</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center"><strong>引数</strong></th>
      <th style="text-align: left"><strong>説明</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center"><code class="highlighter-rouge">min_value</code></td>
      <td style="text-align: left">チューニングしたいパラメータの最小値を指定します。</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="highlighter-rouge">max_value</code></td>
      <td style="text-align: left">チューニングしたいパラメータの最大値を指定します。</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="highlighter-rouge">step</code></td>
      <td style="text-align: left">インクリメントしていく値(幅)を指定します。</td>
    </tr>
  </tbody>
</table>

<p>以下が、Keras Tunerに対応させたソースコードとなります。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">build_model</span><span class="p">(</span><span class="n">hp</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Model</span><span class="p">:</span>
    <span class="c1"># モデル定義
</span>    <span class="n">_input</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="n">_hidden</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="n">hp</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="s">'filters'</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> 
                    <span class="n">max_value</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span> 
                    <span class="n">kernel_size</span><span class="o">=</span><span class="n">hp</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="s">'kernel_size'</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                    <span class="n">max_value</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> 
                    <span class="n">strides</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">padding</span><span class="o">=</span><span class="s">'valid'</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s">'relu'</span><span class="p">)(</span><span class="n">_input</span><span class="p">)</span>
    <span class="n">_hidden</span> <span class="o">=</span> <span class="n">MaxPooling2D</span><span class="p">(</span><span class="n">pool_size</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))(</span><span class="n">_hidden</span><span class="p">)</span>
    <span class="n">_hidden</span> <span class="o">=</span> <span class="n">Flatten</span><span class="p">()(</span><span class="n">_hidden</span><span class="p">)</span>
    <span class="n">_hidden</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">hp</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="s">'units'</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                    <span class="n">max_value</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">50</span><span class="p">),</span> 
                    <span class="n">activation</span><span class="o">=</span><span class="s">'relu'</span><span class="p">)(</span><span class="n">_hidden</span><span class="p">)</span>
    <span class="n">_output</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s">'softmax'</span><span class="p">)(</span><span class="n">_hidden</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">_input</span><span class="p">,</span> <span class="n">_output</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">Adam</span><span class="p">(</span><span class="n">hp</span><span class="o">.</span><span class="n">Choice</span><span class="p">(</span><span class="s">'learning_rate'</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="mf">1e-2</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="mf">1e-4</span><span class="p">])),</span>
        <span class="n">loss</span><span class="o">=</span><span class="s">'categorical_crossentropy'</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s">'accuracy'</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">model</span>
</code></pre></div></div>

<h4 id="233-データの読み込み">2.3.3 データの読み込み</h4>
<p>データセットの読み込み部は一切変更する必要はありません。無印のKeras用に実装したソースコードをそのまま活用できます。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">),</span> <span class="p">(</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span> <span class="o">=</span> <span class="n">cifar10</span><span class="o">.</span><span class="n">load_data</span><span class="p">()</span>
<span class="n">x_train</span> <span class="o">=</span> <span class="n">x_train</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">'float'</span><span class="p">)</span> <span class="o">/</span> <span class="mf">255.</span>
<span class="n">x_test</span> <span class="o">=</span> <span class="n">x_test</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">'float'</span><span class="p">)</span> <span class="o">/</span> <span class="mf">255.</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">to_categorical</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">num_classes</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">to_categorical</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">num_classes</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="234-randomsearchクラスのインスタンス生成">2.3.4 RandomSearchクラスのインスタンス生成</h4>
<p>ここからが本題になります。まずは、ランダムサーチを行うためのインスタンス <code class="highlighter-rouge">tuner</code> を生成します。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tuner</span> <span class="o">=</span> <span class="n">RandomSearch</span><span class="p">(</span><span class="n">build_model</span><span class="p">,</span> <span class="n">objective</span><span class="o">=</span><span class="s">'val_accuracy'</span><span class="p">,</span>
        <span class="n">max_trials</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">executions_per_trial</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="s">'tuning'</span><span class="p">,</span> <span class="n">project_name</span><span class="o">=</span><span class="s">'log'</span><span class="p">)</span>
</code></pre></div></div>

<p>RandomSearch クラスの主な引数は次の表の通りです。</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center"><strong>引数</strong></th>
      <th style="text-align: left"><strong>説明</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center"><code class="highlighter-rouge">hypermodel</code></td>
      <td style="text-align: left"><code class="highlighter-rouge">HyperModel</code> クラスのインスタンスか、ハイパーパラメータを引数にとる、<code class="highlighter-rouge">Model</code> インスタンスを返す関数を与えます。</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="highlighter-rouge">objective</code></td>
      <td style="text-align: left">何を基準に最適化を行うかを指定します。</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="highlighter-rouge">max_trials</code></td>
      <td style="text-align: left">最大何回探索を行うかを指定します。</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="highlighter-rouge">executions_per_trial</code></td>
      <td style="text-align: left">一回の探索で何回学習を繰り返すかを指定できます。<br />複数回指定すると、結果を安定させる効果があります。</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="highlighter-rouge">directory</code></td>
      <td style="text-align: left">ログの保存先ディレクトリを指定します。</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="highlighter-rouge">project_name</code></td>
      <td style="text-align: left">ログの保存先ディレクトリ2を指定します。<br />つまり、<code class="highlighter-rouge">directory</code>/<code class="highlighter-rouge">project_name</code>下にログファイルが保存されます。</td>
    </tr>
  </tbody>
</table>

<h4 id="234-ランダムサーチの実行">2.3.4 ランダムサーチの実行</h4>
<p>RandomSearch クラスのインスタンスを生成したら、ランダムサーチを実行できます。その前に、<code class="highlighter-rouge">search_space_summary()</code>メソッドを使って、探索候補を確認することができます。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tuner</span><span class="o">.</span><span class="n">search_space_summary</span><span class="p">()</span>
</code></pre></div></div>

<p>実行結果：</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[Search space summary]
 |-Default search space size: 4
 &gt; filters (Range)
 |-default: None
 |-max_value: 40
 |-min_value: 10
 |-step: 10
 &gt; kernel_size (Range)
 |-default: None
 |-max_value: 5
 |-min_value: 2
 |-step: 1
 &gt; units (Range)
 |-default: None
 |-max_value: 200
 |-min_value: 50
 |-step: 50
 &gt; learning_rate (Choice)
 |-default: 0.01
 |-values: [0.01, 0.001, 0.0001]
</code></pre></div></div>
<p>探索候補の範囲が定義した通りに表示されていますね。</p>

<p>では、本題の探索に移っていきましょう。探索は、<code class="highlighter-rouge">search()</code> メソッドを使います。このメソッドは、<code class="highlighter-rouge">model.fit()</code>に対応しています。</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tuner</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">))</span>
</code></pre></div></div>

<h4 id="235-チューニング結果の確認">2.3.5 チューニング結果の確認</h4>
<p>チューニングの結果は、<code class="highlighter-rouge">results_summary()</code> で確認できます。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tuner</span><span class="o">.</span><span class="n">results_summary</span><span class="p">()</span>
</code></pre></div></div>

<p>実行結果：</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[Results summary]
 |-Results in tuning/log
 |-Ran 5 trials
 |-Ran 5 executions (1 per trial)
 |-Best val_accuracy: 0.6094
</code></pre></div></div>

<p>実行結果から、最高精度を記録したパラメータの設定は下記の設定のときでした。<br />
今回は5回しか探索をしていないので、最適なパラメータが得られたとは言い難いです。実データでパラメータチューニングを行う際は、探索空間の大きさに応じて探索回数を適度に増やすのが無難です。</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"values": {"filters": 10, "kernel_size": 3, "units": 50, "learning_rate": 0.001}
</code></pre></div></div>

<blockquote>
  <p>今回は使いませんでしたが、<code class="highlighter-rouge">get_best_models()</code> で最良の結果を残したモデルをピックアップできます。（このメソッドを使わなくても、重みファイルは自動で保存されます。）</p>
</blockquote>

<h2 id="まとめ">まとめ</h2>
<p>今回は、Keras Tunerを活用したハイパーパラメータチューニングの方法について紹介をしました。簡単に使えるので便利ですね。</p>

<p>他にも便利なチューニングツール（例: Optuna）が数多く公開されているので、確認してみると良いかもしれません。</p>

<h2 id="ソースコード">ソースコード</h2>
<p>ソースコードは、<a href="https://github.com/gucci-j/intro-deep-learning-keras/">GitHub</a>にて公開してあります。</p>

  </div>

  <style type="text/css">
    @font-face {
	font-family: 'icomoon';
	src:url('/resources/fonts/icomoon.eot?ookgoz');
	src:url('/resources/fonts/icomoon.eot?ookgoz#iefix') format('embedded-opentype'),
		url('/resources/fonts/icomoon.ttf?ookgoz') format('truetype'),
		url('/resources/fonts/icomoon.woff?ookgoz') format('woff'),
		url('/resources/fonts/icomoon.svg?ookgoz#icomoon') format('svg');
		font-weight: normal;
		font-style: normal;
    }

    [class^="icon-"], [class*=" icon-"] {
        /* use !important to prevent issues with browser extensions that change fonts */
        font-family: 'icomoon' !important;
        speak: none;
        font-style: normal;
        font-weight: normal;
        font-variant: normal;
        text-transform: none;
        line-height: inherit;
        
        /* Better Font Rendering =========== */
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }

    .icon-line:before        {content: "\e90a";}
    .icon-pocket:before      {content: "\e902";}
    .icon-twitter:before     {content: "\ea96";}
    .icon-facebook:before    {content: "\ea90";}
    .icon-hatebu:before      {content: "\e903";}

    .amazon-icon::before     {content: "Amazon.co.jpで買って応援！";}

    /*ソーシャルリストデザイン2*/
    .shareList2 {
        list-style:none;
        display: flex;
        flex-wrap:wrap;
        width:100%;
        margin:-5px 0 0 -5px;
        padding:0;
    }
    .shareList2__item {
        height:30px;
        line-height:30px;
        width:30px;
        margin:5px 0 0 5px;
        text-align:center;
    }
    .shareList2__item__amazon {
        height:30px;
        line-height:30px;
        width: 240px;
        margin:5px 0 0 5px;
        text-align:center;
    }
    .shareList2__link {
        display:block;
        color:#ffffff;
        text-decoration: none;
        border-radius: 5px;
    }
    .shareList2__link::before{
        font-size:16px;
        display:block;
        transition: ease-in-out .2s;
        border-radius: 5px;
    }
    .shareList2__link:hover::before{
        background:#ffffff;
        transform: scale(1.2);
        box-shadow:1px 1px 4px 0px rgba(0,0,0,0.15);
    }

    .shareList2__link__amazon {
        display:block;
        color:#ffffff;
        text-decoration: none;
        border-radius: 5px;
    }
    .shareList2__link__amazon::before{
        font-size:16px;
        display:block;
        transition: ease-in-out .2s;
        border-radius: 5px;
    }
    .shareList2__link__amazon:hover::before{
        background:#ffffff;
        box-shadow:1px 1px 4px 0px rgba(0,0,0,0.15);
    }

    .shareList2__link.icon-twitter{background:#55acee;}
    .shareList2__link.icon-twitter:hover::before{color:#55acee;}

    .shareList2__link.icon-facebook{background:#3B5998;}
    .shareList2__link.icon-facebook:hover::before{color:#3B5998;}

    .shareList2__link.icon-hatebu{background:#008FDE;}
    .shareList2__link.icon-hatebu:hover::before{color:#008FDE;}

    .shareList2__link.icon-pocket{background:#EB4654;}
    .shareList2__link.icon-pocket:hover::before{color:#EB4654;}

    .shareList2__link.icon-line{background:#1dcd00;}
    .shareList2__link.icon-line:hover::before{color:#1dcd00;}

    .shareList2__link__amazon.amazon-icon{background:#ff9900;}
    .shareList2__link__amazon.amazon-icon:hover::before{color:#ff9900;}
</style>

<ul class="shareList2" style="margin-top: 5px;">
    <li class="shareList2__item"><a class="shareList2__link icon-twitter" href="https://twitter.com/intent/tweet?text=%E5%AE%9F%E8%A3%85%E3%81%A8%E3%81%A8%E3%82%82%E3%81%AB%E5%AD%A6%E3%81%B6%E3%83%8F%E3%82%A4%E3%83%91%E3%83%BC%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E3%83%81%E3%83%A5%E3%83%BC%E3%83%8B%E3%83%B3%E3%82%B0%E3%81%AE%E3%81%8A%E8%A9%B1+–+%E3%81%8D%E3%81%BE%E3%81%BE%E3%81%ABNLP&amp;url=http%3A%2F%2Flocalhost%3A4000%2Ftuning-intro%2F" target="_blank" title="Twitter"></a></li>
    <li class="shareList2__item"><a class="shareList2__link icon-facebook" href="https://www.facebook.com/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Ftuning-intro%2F" target="_blank" title="Facebook"></a></li>
    <li class="shareList2__item"><a class="shareList2__link icon-hatebu" href="https://b.hatena.ne.jp/add?mode=confirm&amp;url=http%3A%2F%2Flocalhost%3A4000%2Ftuning-intro%2F" target="_blank" title="はてなブックマーク"></a></li>
    <li class="shareList2__item"><a class="shareList2__link icon-pocket" href="//getpocket.com/edit?url=http%3A%2F%2Flocalhost%3A4000%2Ftuning-intro%2F&title=%E5%AE%9F%E8%A3%85%E3%81%A8%E3%81%A8%E3%82%82%E3%81%AB%E5%AD%A6%E3%81%B6%E3%83%8F%E3%82%A4%E3%83%91%E3%83%BC%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E3%83%81%E3%83%A5%E3%83%BC%E3%83%8B%E3%83%B3%E3%82%B0%E3%81%AE%E3%81%8A%E8%A9%B1+–+%E3%81%8D%E3%81%BE%E3%81%BE%E3%81%ABNLP" target="_blank" title="Pocket"></a></li>
    <li class="shareList2__item"><a class="shareList2__link icon-line" href="http://line.me/R/msg/text/?%E5%AE%9F%E8%A3%85%E3%81%A8%E3%81%A8%E3%82%82%E3%81%AB%E5%AD%A6%E3%81%B6%E3%83%8F%E3%82%A4%E3%83%91%E3%83%BC%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E3%83%81%E3%83%A5%E3%83%BC%E3%83%8B%E3%83%B3%E3%82%B0%E3%81%AE%E3%81%8A%E8%A9%B1+–+%E3%81%8D%E3%81%BE%E3%81%BE%E3%81%ABNLP%0Ahttp%3A%2F%2Flocalhost%3A4000%2Ftuning-intro%2F" target="_blank" title="LINE"></a></li>
    <li class="shareList2__item__amazon"><a class="shareList2__link__amazon amazon-icon" href="//af.moshimo.com/af/c/click?a_id=1430714&p_id=170&pc_id=185&pl_id=4062&url=https%3A%2F%2Fwww.amazon.co.jp%2F" target="_blank" rel="nofollow"></a>
        <img src="//i.moshimo.com/af/i/impression?a_id=1430714&p_id=170&pc_id=185&pl_id=4062" width="1" height="1" style="border:none;"></li>
</ul>

  <br />

  <div class="footer_ads">
    <div class="left_ad">
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <!-- フッター1 -->
        <ins class="adsbygoogle"
            style="display:block"
            data-ad-client="ca-pub-1838422896597988"
            data-ad-slot="4583840862"
            data-ad-format="auto"
            data-full-width-responsive="true"></ins>
        <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
    </div>

    <div class="right_ad">
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <!-- フッター2 -->
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-1838422896597988"
             data-ad-slot="3446169345"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
        <script>
             (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
    </div>
  </div>
  <br />

  <!-- 前後のページへのリンク-->
  <div class="pager">
    
      <div class="prev">
        <p><i class="fas fa-arrow-circle-left" style="margin: 0 0.5em 0 0;"></i>前の記事</p>
        <p>
            <a href="/cv-intro/">実装とともに学ぶ交差検証のお話</a>
        </p>
      </div>
    

    
  </div>

  
  
</article>

      </main>

      <aside class="sidebar" role="complementary">
        <div class="side-ad">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- サイドバー -->
  <ins class="adsbygoogle"
      style="display:block"
      data-ad-client="ca-pub-1838422896597988"
      data-ad-slot="3641305571"
      data-ad-format="auto"
      data-full-width-responsive="true"></ins>
  <script>
      (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>

<div class="profile">
  <div style="text-align: center;">
    <a href="/about/">
      <img style="width: 100px; border-radius: 50px;" src="/resources/logo/profile.jpg" />
    </a>
    <p style="padding: 0; margin: 0.25em 0 0 0; line-height: 1;"><strong>Gucci</strong></p>
  </div>
  <p style="margin-top: 0.5em; margin-bottom: 0; font-size: 0.8em; text-align: center;">
    自然言語処理や機械学習に関連する情報を発信しています。
    留学系の話題も<a href="https://note.mu/_gucciiiii">note</a>に書いています。
  </p>
  <hr />
  <div class="profile_icon">
    
<a href="/contact/"><i class="svg-icon email"></i></a>


<a href="https://github.com/gucci-j"><i class="svg-icon github"></i></a>



<a href="/feed.xml"><i class="svg-icon rss"></i></a>
<a href="https://www.twitter.com/_gucciiiii"><i class="svg-icon twitter"></i></a>



  </div>
</div>

<div class="amazon-button">
  <p style="margin-top: 0; margin-bottom: 0.5em; font-size: 0.8em; text-align: center;">
    <strong>Amazon.co.jpで買って応援！</strong>
  </p>
  <div style="text-align: center;">
    <a href="//af.moshimo.com/af/c/click?a_id=1430714&p_id=170&pc_id=185&pl_id=10340&guid=ON" target="_blank" rel="nofollow"><img src="//image.moshimo.com/af-img/0068/000000010340.gif" width="300" height="50" style="border:none; padding-bottom: 0;"></a>
    <img src="//i.moshimo.com/af/i/impression?a_id=1430714&p_id=170&pc_id=185&pl_id=10340" width="0" height="0" style="display: none; border:none;">
  </div>
</div>

<div class="search">
  <script>
    (function() {
      var cx = 'partner-pub-1838422896597988:8655986192';
      var gcse = document.createElement('script');
      gcse.type = 'text/javascript';
      gcse.async = true;
      gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(gcse, s);
    })();
  </script>
  <gcse:searchbox-only></gcse:searchbox-only>
</div>

<div class="study-abroad">
  <p style="padding: 0; margin: 0.25em 0 0 0; line-height: 1; text-align: center;">
    <strong>留学関連の記事</strong>
  </p>
  <hr />
  <ul style="padding: 0 10px 0 10px;">
    <li>
      <a href="https://gucci-j.github.io/study-abroad/">大学院留学について</a>
    </li>
    <li>
      <a href="https://gucci-j.github.io/study-abroad/crowd-funding">クラウドファンディングのお願い</a>
    </li>
  </ul>
</div>

<div class="recent-posts">
  <p style="padding: 0; margin: 0.25em 0 0 0; line-height: 1; text-align: center;">
    <strong>最近の記事</strong>
  </p>
  <hr />
  <ul style="padding-right: 5px; padding-left: 1.5em;">
    
      <li>
        <a href="/tuning-intro/">
          実装とともに学ぶハイパーパラメータチューニングのお話
        </a>
      </li>
    
      <li>
        <a href="/cv-intro/">
          実装とともに学ぶ交差検証のお話
        </a>
      </li>
    
      <li>
        <a href="/Note-Decoupling/">
          論文メモ：Decoupling Strategy and Generation in Negotiation Dialogues
        </a>
      </li>
    
      <li>
        <a href="/memo-svm/">
          サポートベクターマシンのお話
        </a>
      </li>
    
      <li>
        <a href="/cv-with-torchtext/">
          torchtextでk-分割交差検証をする話
        </a>
      </li>
    
  </ul>
</div>









<div class="side-category">
  <p style="padding: 0; margin: 0.25em 0 0 0; line-height: 1; text-align: center;">
    <strong>タグ一覧</strong>
  </p>
  <hr />
  <ul style="padding: 0 10px 0 10px;">
    
      <li>
        <a href="/sitemap#PyTorch">
          PyTorch
        </a>
      </li>
    
      <li>
        <a href="/sitemap#Tips">
          Tips
        </a>
      </li>
    
      <li>
        <a href="/sitemap#「ゼロからKeras」シリーズ">
          「ゼロからKeras」シリーズ
        </a>
      </li>
    
      <li>
        <a href="/sitemap#ブログ全般">
          ブログ全般
        </a>
      </li>
    
      <li>
        <a href="/sitemap#機械学習全般">
          機械学習全般
        </a>
      </li>
    
      <li>
        <a href="/sitemap#論文メモ">
          論文メモ
        </a>
      </li>
    
  </ul>
</div>

      </aside>
    </div>

    <div class="wrapper-footer">
      <div class="footer_container">
        <footer class="footer">
          
<a href="/contact/"><i class="svg-icon email"></i></a>


<a href="https://github.com/gucci-j"><i class="svg-icon github"></i></a>



<a href="/feed.xml"><i class="svg-icon rss"></i></a>
<a href="https://www.twitter.com/_gucciiiii"><i class="svg-icon twitter"></i></a>


<br />
          <a href="/">Home</a>
          | <a href="/Introduction/">About This Blog</a>  
          | <a href="/sitemap/">Sitemap</a> 
          | <a href="/privacy/">Privacy</a><br />
          <div style="font-size: 8pt;">© 2019 Atsuki Yamaguchi.</div>
        </footer>
      </div>
    </div>

    
	<!-- Google Analytics -->
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-137498199-1', 'auto');
		ga('send', 'pageview', {
		  'page': '/tuning-intro/',
		  'title': '実装とともに学ぶハイパーパラメータチューニングのお話'
		});
	</script>
	<!-- End Google Analytics -->


  </body>
</html>
